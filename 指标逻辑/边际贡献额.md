# ğŸ“Œ è¾¹é™…è´¡çŒ®é¢ | `marginal_contribution_amount_in_10k`

---

## 1. æŒ‡æ ‡å®šä¹‰
- **å­—æ®µå**ï¼š`marginal_contribution_amount_in_10k`  
- **å•ä½**ï¼šä¸‡å…ƒ  
- **ç±»å‹ï¼ˆDB å­˜å‚¨ï¼‰**ï¼š`numeric(18,4)`  
- **å±•ç¤ºç²¾åº¦**ï¼šä¿ç•™ 1 ä½å°æ•°  
- **å«ä¹‰**ï¼šåœ¨ç»Ÿè®¡æœŸå†…ï¼Œä¸šåŠ¡åœ¨æ»¡æœŸå‡€ä¿è´¹ä¸­æ‰£é™¤å˜åŠ¨æˆæœ¬ï¼ˆèµ”æ¬¾ + è´¹ç”¨ï¼‰åï¼Œæ‰€å½¢æˆçš„**å¯ç”¨äºè¦†ç›–å›ºå®šæˆæœ¬ä¸åˆ›é€ åˆ©æ¶¦çš„é‡‘é¢**ã€‚åæ˜ ä¸šåŠ¡åœ¨é£é™©æˆæœ¬ä¸è´¹ç”¨ä¹‹åçš„å‰©ä½™ç›ˆåˆ©èƒ½åŠ›ã€‚  

---

## 2. è®¡ç®—å…¬å¼ï¼ˆå…¬å¸ç»Ÿä¸€å£å¾„ï¼Œæ¨å¯¼ï¼‰
è¡¨æ ¼ä¸­ `marginal_contribution_amount_in_10k` å·²æä¾›ï¼Œä½†éœ€é€šè¿‡å…¬å¼æ¨å¯¼æ ¡æ ¸ï¼š  

```text
è¾¹é™…è´¡çŒ®é¢ (marginal_contribution_amount_in_10k, ä¸‡å…ƒ) =
    SUM(expired_net_premium_in_10k) Ã— marginal_contribution_ratio

å…¶ä¸­ï¼š
	â€¢	expired_net_premium_in_10kï¼šç´¯è®¡æ»¡æœŸå‡€ä¿è´¹ï¼ˆä¸‡å…ƒï¼‰
	â€¢	marginal_contribution_ratioï¼šè¾¹é™…è´¡çŒ®ç‡ï¼Œå°æ•°å½¢å¼å­˜å‚¨ï¼ˆ0.2345 è¡¨ç¤º 23.45%ï¼‰

â¸»

3. è®¡ç®—é¡ºåº
	1.	è®¡ç®—å˜åŠ¨æˆæœ¬ç‡ï¼š

variable_cost_ratio = ( SUM(row_expense_amount_in_10k) Ã· SUM(documented_premium_in_10k) )
                    + ( SUM(total_claim_payment_in_10k) Ã· SUM(expired_net_premium_in_10k) )


	2.	è®¡ç®—è¾¹é™…è´¡çŒ®ç‡ï¼š

marginal_contribution_ratio = 1 â€“ variable_cost_ratio


	3.	è®¡ç®—è¾¹é™…è´¡çŒ®é¢ï¼š

marginal_contribution_amount_in_10k = SUM(expired_net_premium_in_10k) Ã— marginal_contribution_ratio


	4.	å­˜å‚¨å£å¾„ï¼šnumeric(18,4)ï¼ˆä¸‡å…ƒï¼‰ï¼›
æŠ¥è¡¨å±•ç¤ºæ—¶ ROUND(marginal_contribution_amount_in_10k,1)ï¼Œä¿ç•™ 1 ä½å°æ•°ã€‚

â¸»

4. æ³¨æ„äº‹é¡¹
	â€¢	ä¾èµ–æŒ‡æ ‡ï¼šå¿…é¡»å…ˆè®¡ç®— variable_cost_ratio â†’ marginal_contribution_ratioï¼Œå†å¾—åˆ° marginal_contribution_amount_in_10kã€‚
	â€¢	å•ä½ä¸€è‡´æ€§ï¼šåˆ†æ¯ä¸åˆ†å­éœ€ä¿æŒåœ¨ä¸‡å…ƒå£å¾„ï¼Œé¿å…å› æ¢ç®—é—æ¼å¯¼è‡´åå·®ã€‚
	â€¢	ç»“æœç‰¹å¾ï¼š
	â€¢	ç»“æœå¯ä¸ºæ­£æˆ–è´Ÿï¼šè´Ÿå€¼è¡¨ç¤ºæ»¡æœŸå‡€ä¿è´¹ä¸è¶³ä»¥è¦†ç›–èµ”ä»˜+è´¹ç”¨ï¼Œä¸šåŠ¡å¤„äºäºæŸçŠ¶æ€ï¼›
	â€¢	æ­£å€¼è¡¨ç¤ºå­˜åœ¨å¯ä¾›è¦†ç›–å›ºå®šæˆæœ¬ä¸åˆ©æ¶¦çš„ç©ºé—´ã€‚
	â€¢	æ ¡æ ¸å…³ç³»ï¼š

marginal_contribution_amount_in_10k Ã· expired_net_premium_in_10k â‰ˆ marginal_contribution_ratio



â¸»

5. å®ç°ç¤ºä¾‹ï¼ˆPostgres / Supabase SQLï¼‰

WITH base AS (
  SELECT
    policy_start_year,
    week_number,
    third_level_organization,
    SUM(row_expense_amount_in_10k)      AS sum_expense_amount,
    SUM(documented_premium_in_10k)      AS sum_doc_premium,
    SUM(total_claim_payment_in_10k)     AS sum_claim_payment,
    SUM(expired_net_premium_in_10k)     AS sum_expired_premium
  FROM auto_insurance_metrics
  GROUP BY 1,2,3
),
calc AS (
  SELECT
    policy_start_year,
    week_number,
    third_level_organization,
    ( (sum_expense_amount / NULLIF(sum_doc_premium,0)) 
    + (sum_claim_payment / NULLIF(sum_expired_premium,0)) ) AS variable_cost_ratio,
    sum_expired_premium
  FROM base
)
SELECT
  policy_start_year,
  week_number,
  third_level_organization,
  CASE 
    WHEN sum_expired_premium > 0
      THEN ROUND(sum_expired_premium * (1 - variable_cost_ratio), 1)
    ELSE NULL
  END AS marginal_contribution_amount_in_10k
FROM calc
ORDER BY policy_start_year, week_number, third_level_organization;


â¸»

6. å£å¾„è¯´æ˜
	â€¢	å…¬å¸å£å¾„ï¼š

è¾¹é™…è´¡çŒ®é¢ = æ»¡æœŸå‡€ä¿è´¹ Ã— è¾¹é™…è´¡çŒ®ç‡


	â€¢	å±•ç¤ºå±‚ï¼šä¿ç•™ 1 ä½å°æ•°ï¼ˆä¸‡å…ƒï¼‰ï¼›
	â€¢	è¡Œä¸šå¯¹æ¯”ï¼šè¾¹é™…è´¡çŒ®é¢ç›¸å½“äºâ€œå·²èµšä¿è´¹ â€“ èµ”æ¬¾ â€“ è´¹ç”¨â€ï¼Œæ˜¯ç»è¥è´¨é‡å’Œç›ˆåˆ©èƒ½åŠ›çš„æ ¸å¿ƒæŒ‡æ ‡ã€‚