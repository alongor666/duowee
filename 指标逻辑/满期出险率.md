# 📌 满期出险率 | `claim_frequency`

---

## 1. 指标定义
- **字段名**：`claim_frequency`  
- **单位**：小数  
- **类型（DB 存储）**：`numeric(10,6)`（存库为小数，例：0.123456）  
- **展示精度**：保留 1 位小数  
- **含义**：在统计期内，反映每张保单在满期责任范围内发生赔案的频率。与单纯“报案件数/保单件数”的计算不同，本公司口径引入 **满期净保费 / 跟单保费** 的修正系数，更真实体现风险暴露程度。  

---

## 2. 计算公式（公司统一口径）

```text
满期出险率 (claim_frequency) =
    ( SUM(case_count) ÷ SUM(policy_count) ) 
  × ( SUM(expired_net_premium_in_10k) ÷ SUM(documented_premium_in_10k) )

其中：
	•	case_count（赔案件数，件）需推导：

case_count = ( total_claim_payment_in_10k × 10000 ) ÷ average_claim_payment


	•	policy_count（保单件数，件）需推导：

policy_count = ( documented_premium_in_10k × 10000 ) ÷ average_premium_per_policy


	•	expired_net_premium_in_10k（满期净保费，万元）
	•	documented_premium_in_10k（跟单保费，万元）

⸻

3. 计算顺序
	1.	推导件数：
	•	计算 case_count、policy_count。
	2.	聚合绝对值：
	•	sum_case_count = Σ(case_count)
	•	sum_policy_count = Σ(policy_count)
	•	sum_expired_premium = Σ(expired_net_premium_in_10k)
	•	sum_doc_premium = Σ(documented_premium_in_10k)
	3.	分步计算：
	•	先算案件频度比率：case_ratio = sum_case_count / sum_policy_count
	•	再算保费暴露比率：premium_ratio = sum_expired_premium / sum_doc_premium
	4.	合并得出结果：
	•	claim_frequency = case_ratio × premium_ratio
	•	存库为小数（如 0.0765）；报表展示为 0.0765。

⸻

4. 注意事项
	•	单位换算：涉及金额时，记得将万元转换为元再进行推导件数。
	•	分母限制：若 policy_count=0 或 documented_premium_in_10k=0，则结果置为 NULL。
	•	数据口径：
	•	使用 赔案件数（case_count）而非报案件数；
	•	必须结合保费暴露比例 (满期净保费 / 跟单保费)。
	•	校核方法：
	•	检查 (case_count × average_claim_payment) / 10000 ≈ total_claim_payment_in_10k 是否一致；
	•	对比 claim_frequency 与 expired_loss_ratio 的趋势是否匹配（赔付率高的业务出险率通常也高）。

⸻

5. 实现示例（Postgres / Supabase SQL）

WITH base AS (
  SELECT
    policy_start_year,
    week_number,
    third_level_organization,
    SUM((total_claim_payment_in_10k * 10000) / NULLIF(average_claim_payment,0)) AS sum_case_count,
    SUM((documented_premium_in_10k * 10000) / NULLIF(average_premium_per_policy,0)) AS sum_policy_count,
    SUM(expired_net_premium_in_10k) AS sum_expired_premium,
    SUM(documented_premium_in_10k)  AS sum_doc_premium
  FROM auto_insurance_metrics
  GROUP BY 1,2,3
)
SELECT
  policy_start_year,
  week_number,
  third_level_organization,
  CASE 
    WHEN sum_policy_count > 0 AND sum_doc_premium > 0
      THEN ROUND(( (sum_case_count / sum_policy_count) * (sum_expired_premium / sum_doc_premium) ), 4)
    ELSE NULL
  END AS claim_frequency
FROM base
ORDER BY policy_start_year, week_number, third_level_organization;


⸻

6. 口径说明
	•	公司口径（已统一多年）：

满期出险率 = (赔案件数 ÷ 保单件数) × (满期净保费 ÷ 跟单保费)


	•	行业对比：
	•	行业内常见“出险率”= 出险保单数 ÷ 有效保单数；
	•	本公司口径通过引入保费暴露修正因子，更符合实际风险承担特征。