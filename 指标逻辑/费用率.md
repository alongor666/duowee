# ğŸ“Œ è´¹ç”¨ç‡ | `expense_ratio`

---

## 1. æŒ‡æ ‡å®šä¹‰
- **å­—æ®µå**ï¼š`expense_ratio`  
- **å•ä½**ï¼šå°æ•°  
- **ç±»å‹ï¼ˆDB å­˜å‚¨ï¼‰**ï¼š`numeric(10,6)`ï¼ˆå­˜åº“ä¸ºå°æ•°ï¼Œä¾‹ï¼š0.2134ï¼‰  
- **å±•ç¤ºç²¾åº¦**ï¼šä¿ç•™ 1 ä½å°æ•°  
- **å«ä¹‰**ï¼šåœ¨ç»Ÿè®¡æœŸå†…ï¼Œè´¹ç”¨å ç­¾å•ä¿è´¹çš„æ¯”ä¾‹ã€‚åæ˜ ä¸šåŠ¡ç»è¥è¿‡ç¨‹ä¸­è´¹ç”¨æ¶ˆè€—å¯¹ä¿è´¹æ”¶å…¥çš„å æ¯”æƒ…å†µï¼Œæ˜¯è¡¡é‡è´¹ç”¨ç®¡æ§èƒ½åŠ›çš„é‡è¦æŒ‡æ ‡ã€‚  

---

## 2. è®¡ç®—å…¬å¼ï¼ˆå…¬å¸å£å¾„ï¼‰
è¡¨æ ¼ä¸­å·²ç›´æ¥æä¾› `expense_ratio`ï¼Œå¯ç›´æ¥å–å€¼ï¼›åŒæ—¶å¯é€šè¿‡æ¨å¯¼å…¬å¼è¿›è¡Œæ ¡æ ¸ï¼š  

```text
è´¹ç”¨ç‡ (expense_ratio) = ( SUM(row_expense_amount_in_10k) Ã· SUM(documented_premium_in_10k) )

å…¶ä¸­ï¼š
	â€¢	row_expense_amount_in_10kï¼ˆè´¹ç”¨é‡‘é¢ï¼Œä¸‡å…ƒï¼‰ = documented_premium_in_10k Ã— expense_ratio
	â€¢	documented_premium_in_10kï¼šç´¯è®¡ç­¾å•ä¿è´¹ï¼Œä¸‡å…ƒ

â¸»

3. è®¡ç®—é¡ºåº
	1.	è®¡ç®—è´¹ç”¨é‡‘é¢ï¼ˆæ¨å¯¼å­—æ®µï¼‰ï¼š
	â€¢	row_expense_amount_in_10k = documented_premium_in_10k Ã— (expense_ratio)
	â€¢	æ³¨æ„ï¼šexpense_ratio åœ¨åº“ä¸­å­˜å‚¨ä¸ºå°æ•°ï¼ˆå¦‚ 0.2134ï¼‰ï¼Œè®¡ç®—æ—¶ç›´æ¥ç›¸ä¹˜å³å¯ã€‚
	2.	èšåˆå£å¾„ï¼š
	â€¢	sum_expense_amount = Î£(row_expense_amount_in_10k)
	â€¢	sum_doc_premium = Î£(documented_premium_in_10k)
	3.	è®¡ç®—è´¹ç”¨ç‡ï¼š
	â€¢	expense_ratio = sum_expense_amount Ã· sum_doc_premium
	â€¢	å­˜åº“ä¸ºå°æ•°ï¼ˆä¾‹ï¼š0.2056ï¼‰ï¼›æŠ¥è¡¨å±•ç¤ºæ—¶ ROUND(expense_ratio, 4)ã€‚

â¸»

4. æ³¨æ„äº‹é¡¹
	â€¢	æ•°æ®å£å¾„ï¼šè´¹ç”¨ç‡ä»¥ ç­¾å•ä¿è´¹ ä½œä¸ºåˆ†æ¯ï¼Œä¿æŒä¸å…¬å¸å¤šå¹´å…±è¯†ä¸€è‡´ã€‚
	â€¢	è´¹ç”¨é‡‘é¢ä¸ºæ¨å¯¼å­—æ®µï¼ˆåŸºäºç­¾å•ä¿è´¹å’Œè´¹ç”¨ç‡è®¡ç®—ï¼‰ï¼Œéœ€ç¡®è®¤ä¸åŸå§‹è´¹ç”¨æ•°æ®å£å¾„åŒ¹é…ã€‚
	â€¢	è¾¹ç•Œæ¡ä»¶ï¼šè‹¥ documented_premium_in_10k=0ï¼Œåˆ™è¿”å› NULL æˆ– 0ï¼Œé¿å…é™¤é›¶é”™è¯¯ã€‚

â¸»

5. å®ç°ç¤ºä¾‹ï¼ˆPostgres / Supabase SQLï¼‰

WITH base AS (
  SELECT
    policy_start_year,
    week_number,
    third_level_organization,
    SUM(documented_premium_in_10k) AS sum_doc_premium,
    SUM(row_expense_amount_in_10k) AS sum_expense_amount
  FROM auto_insurance_metrics
  GROUP BY 1,2,3
)
SELECT
  policy_start_year,
  week_number,
  third_level_organization,
  CASE 
    WHEN sum_doc_premium > 0
      THEN ROUND((sum_expense_amount / sum_doc_premium), 4)
    ELSE NULL
  END AS expense_ratio
FROM base
ORDER BY policy_start_year, week_number, third_level_organization;


â¸»

6. å£å¾„è¯´æ˜
	â€¢	å…¬å¸å£å¾„ï¼šè´¹ç”¨ç‡ = è´¹ç”¨é‡‘é¢ Ã· ç­¾å•ä¿è´¹ã€‚
	â€¢	è¡Œä¸šå¯¹æ¯”ï¼šå¸¸ä¸â€œç»¼åˆè´¹ç”¨ç‡â€æˆ–â€œè´¹ç”¨ç‡â€å®šä¹‰ä¸€è‡´ï¼Œç”¨äºè¡¡é‡ä¸šåŠ¡è·å–ä¸ç»´ç³»æˆæœ¬å¯¹ä¿è´¹æ”¶å…¥çš„æ¶ˆè€—æ¯”ä¾‹ã€‚