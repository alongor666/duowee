# 📌 费用率 | `expense_ratio`

---

## 1. 指标定义
- **字段名**：`expense_ratio`  
- **单位**：小数  
- **类型（DB 存储）**：`numeric(10,6)`（存库为小数，例：0.2134）  
- **展示精度**：保留 1 位小数  
- **含义**：在统计期内，费用占签单保费的比例。反映业务经营过程中费用消耗对保费收入的占比情况，是衡量费用管控能力的重要指标。  

---

## 2. 计算公式（公司口径）
表格中已直接提供 `expense_ratio`，可直接取值；同时可通过推导公式进行校核：  

```text
费用率 (expense_ratio) = ( SUM(row_expense_amount_in_10k) ÷ SUM(documented_premium_in_10k) )

其中：
	•	row_expense_amount_in_10k（费用金额，万元） = documented_premium_in_10k × expense_ratio
	•	documented_premium_in_10k：累计签单保费，万元

⸻

3. 计算顺序
	1.	计算费用金额（推导字段）：
	•	row_expense_amount_in_10k = documented_premium_in_10k × (expense_ratio)
	•	注意：expense_ratio 在库中存储为小数（如 0.2134），计算时直接相乘即可。
	2.	聚合口径：
	•	sum_expense_amount = Σ(row_expense_amount_in_10k)
	•	sum_doc_premium = Σ(documented_premium_in_10k)
	3.	计算费用率：
	•	expense_ratio = sum_expense_amount ÷ sum_doc_premium
	•	存库为小数（例：0.2056）；报表展示时 ROUND(expense_ratio, 4)。

⸻

4. 注意事项
	•	数据口径：费用率以 签单保费 作为分母，保持与公司多年共识一致。
	•	费用金额为推导字段（基于签单保费和费用率计算），需确认与原始费用数据口径匹配。
	•	边界条件：若 documented_premium_in_10k=0，则返回 NULL 或 0，避免除零错误。

⸻

5. 实现示例（Postgres / Supabase SQL）

WITH base AS (
  SELECT
    policy_start_year,
    week_number,
    third_level_organization,
    SUM(documented_premium_in_10k) AS sum_doc_premium,
    SUM(row_expense_amount_in_10k) AS sum_expense_amount
  FROM auto_insurance_metrics
  GROUP BY 1,2,3
)
SELECT
  policy_start_year,
  week_number,
  third_level_organization,
  CASE 
    WHEN sum_doc_premium > 0
      THEN ROUND((sum_expense_amount / sum_doc_premium), 4)
    ELSE NULL
  END AS expense_ratio
FROM base
ORDER BY policy_start_year, week_number, third_level_organization;


⸻

6. 口径说明
	•	公司口径：费用率 = 费用金额 ÷ 签单保费。
	•	行业对比：常与“综合费用率”或“费用率”定义一致，用于衡量业务获取与维系成本对保费收入的消耗比例。