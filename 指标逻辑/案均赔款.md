# ğŸ“Œ æ¡ˆå‡èµ”æ¬¾ | `average_claim_payment`

---

## 1. æŒ‡æ ‡å®šä¹‰
- **å­—æ®µå**ï¼š`average_claim_payment`  
- **å•ä½**ï¼šå…ƒ  
- **ç±»å‹ï¼ˆDB å­˜å‚¨ï¼‰**ï¼š`numeric(18,4)`  
- **å±•ç¤ºç²¾åº¦**ï¼šä¿ç•™ 1 ä½å°æ•°  
- **å«ä¹‰**ï¼šåœ¨ç»Ÿè®¡æœŸå†…ï¼Œ**æ¯ä¸ªèµ”ä»˜æ¡ˆä»¶å¹³å‡æ”¯ä»˜çš„èµ”æ¬¾é‡‘é¢**ã€‚ç”¨äºè¡¡é‡å•æ¡ˆèµ”ä»˜æ°´å¹³ï¼Œåæ˜ èµ”æ¡ˆçš„å¹³å‡æˆæœ¬å¤§å°ã€‚  

---

## 2. è®¡ç®—å…¬å¼ï¼ˆå…¬å¸å£å¾„ï¼‰
è¡¨æ ¼å·²ç›´æ¥æä¾›è¯¥æŒ‡æ ‡ï¼Œä½†å¯é€šè¿‡æ¨å¯¼å…¬å¼æ ¡æ ¸ï¼š  

```text
average_claim_payment(å…ƒ) = ( total_claim_payment_in_10k Ã— 10000 ) Ã· case_count

	â€¢	total_claim_payment_in_10kï¼šç´¯è®¡æ€»èµ”æ¬¾ï¼Œä¸‡å…ƒ
	â€¢	case_countï¼šèµ”æ¡ˆä»¶æ•°ï¼Œä»¶ï¼ˆæ¨å¯¼æˆ–ç»Ÿè®¡å¾—åˆ°ï¼‰

â¸»

3. è®¡ç®—é¡ºåº
	1.	è®¡ç®—æ€»èµ”æ¬¾ï¼ˆå…ƒï¼‰ï¼š
	â€¢	sum_claim_payment_yuan = SUM(total_claim_payment_in_10k) * 10000
	2.	è®¡ç®—èµ”æ¡ˆä»¶æ•°ï¼š
	â€¢	sum_case_count = SUM(case_count)ï¼ˆéœ€æ¨å¯¼æˆ–ç›´æ¥è·å–ï¼‰
	3.	è®¡ç®—æ¡ˆå‡èµ”æ¬¾ï¼š
	â€¢	avg_claim_payment = sum_claim_payment_yuan / sum_case_count
	4.	å­˜å‚¨å£å¾„ï¼šnumeric(18,4)ï¼›æŠ¥è¡¨å±•ç¤ºæ—¶ ROUND(avg_claim_payment,1)ï¼Œä¿ç•™ 1 ä½å°æ•°ã€‚

â¸»

4. æ³¨æ„äº‹é¡¹
	â€¢	æ•°æ®å£å¾„ï¼šæœ¬æŒ‡æ ‡ä»¥ èµ”æ¡ˆä»¶æ•° ä¸ºåˆ†æ¯ï¼Œä¸èƒ½ç”¨â€œæŠ¥æ¡ˆä»¶æ•°â€ä»£æ›¿ã€‚
	â€¢	æ•°æ®æºé™åˆ¶ï¼šå½“å‰è¡¨æ ¼å·²ç›´æ¥æä¾› average_claim_paymentï¼Œä½†å› ç¼ºå°‘åŸå§‹æ¡ˆä»¶æ˜ç»†ï¼Œå¯èƒ½å­˜åœ¨åå·®ã€‚éœ€å®šæœŸä¸ç†èµ”ç³»ç»Ÿæ ¸å¯¹ã€‚
	â€¢	è¾¹ç•Œæ¡ä»¶ï¼šå½“ case_count=0 æ—¶ï¼Œè¿”å› NULL æˆ– 0ï¼Œé¿å…é™¤é›¶é”™è¯¯ã€‚

â¸»

5. å®ç°ç¤ºä¾‹ï¼ˆPostgres / Supabase SQLï¼‰

WITH base AS (
  SELECT
    policy_start_year,
    week_number,
    third_level_organization,
    SUM(total_claim_payment_in_10k) * 10000 AS sum_claim_payment_yuan,
    SUM(case_count) AS sum_case_count
  FROM auto_insurance_metrics
  GROUP BY 1,2,3
)
SELECT
  policy_start_year,
  week_number,
  third_level_organization,
  CASE 
    WHEN sum_case_count > 0 
      THEN ROUND(sum_claim_payment_yuan::numeric / sum_case_count, 1)
    ELSE NULL
  END AS average_claim_payment
FROM base
ORDER BY policy_start_year, week_number, third_level_organization;


â¸»

6. ç¨½æ ¸ä¸è¯Šæ–­æç¤º
	â€¢	ä¸ total_claim_payment_in_10kã€case_count äº¤å‰æ ¡éªŒï¼š

total_claim_payment_in_10k Ã— 10000 â‰ˆ average_claim_payment Ã— case_count


	â€¢	è‹¥å·®å¼‚è¾ƒå¤§ï¼Œè¯´æ˜æºæ•°æ®å£å¾„å¯èƒ½å­˜åœ¨â€œæ¡ˆä»¶æ•°ç»Ÿè®¡ä¸å®Œæ•´â€æˆ–â€œèµ”ä»˜é‡‘é¢åŒ…å«æœªå†³/æ’¤é”€â€ã€‚

â¸»

7. å£å¾„è¯´æ˜
	â€¢	å…¬å¸å£å¾„ï¼šæ¡ˆå‡èµ”æ¬¾ = æ€»èµ”æ¬¾ï¼ˆå…ƒï¼‰ Ã· èµ”æ¡ˆä»¶æ•°ï¼ˆä»¶ï¼‰ã€‚
	â€¢	è¡Œä¸šå¯¹æ¯”ï¼šè¡Œä¸šé€šè¡Œå£å¾„ä¸€è‡´ï¼Œç”¨äºè¡¡é‡å•æ¡ˆèµ”ä»˜æˆæœ¬æ°´å¹³ï¼Œæ˜¯é£é™©å®šä»·å’Œç†èµ”ç®¡æ§çš„å…³é”®æŒ‡æ ‡ã€‚