# 📌 边际贡献率 | `marginal_contribution_ratio`

---

## 1. 指标定义
- **字段名**：`marginal_contribution_ratio`  
- **单位**：小数  
- **类型（DB 存储）**：`numeric(10,6)`（存库为小数，例：0.3478）  
- **展示精度**：保留 1 位小数  
- **含义**：在统计期内，保费收入扣除变动成本后的比例，衡量业务的盈利空间。  
  - 变动成本包括：赔款（`total_claim_payment_in_10k`）与费用（`row_expense_amount_in_10k`）。  
  - 本指标体现了业务在承担风险与费用后的“余量”，即公司可用于弥补固定成本和创造利润的部分。  

---

## 2. 计算公式（公司统一口径，推导）
表格中 `marginal_contribution_ratio` 已直接提供，可用于取数；同时也可通过以下公式推导：  

```text
边际贡献率 (marginal_contribution_ratio) = ( 1 – variable_cost_ratio )

其中：
	•	variable_cost_ratio（变动成本率，存库为小数）
	•	边际贡献率与变动成本率为互补关系

⸻

3. 计算顺序
	1.	计算 variable_cost_ratio：

variable_cost_ratio = ( SUM(row_expense_amount_in_10k) ÷ SUM(documented_premium_in_10k) )
                    + ( SUM(total_claim_payment_in_10k) ÷ SUM(expired_net_premium_in_10k) )

（存库为小数）

	2.	计算边际贡献率：
	•	marginal_contribution_ratio = 1 – variable_cost_ratio
	3.	存库口径：numeric(10,6)（小数形式）；
报表展示时：ROUND(marginal_contribution_ratio, 4)，保留 4 位小数。

⸻

4. 注意事项
	•	口径固定：边际贡献率必须以 1 – 变动成本率 表示，不可直接用边际贡献额/保费替代。
	•	异常值处理：
	•	若 variable_cost_ratio > 1，则边际贡献率可能为负值，需结合业务场景分析。
	•	确保 variable_cost_ratio 的计算逻辑已正确落实。
	•	关联关系：
	•	与 marginal_contribution_amount_in_10k 直接相关：

marginal_contribution_amount_in_10k = expired_net_premium_in_10k × marginal_contribution_ratio



⸻

5. 实现示例（Postgres / Supabase SQL）

WITH base AS (
  SELECT
    policy_start_year,
    week_number,
    third_level_organization,
    SUM(row_expense_amount_in_10k)      AS sum_expense_amount,
    SUM(documented_premium_in_10k)      AS sum_doc_premium,
    SUM(total_claim_payment_in_10k)     AS sum_claim_payment,
    SUM(expired_net_premium_in_10k)     AS sum_expired_premium
  FROM auto_insurance_metrics
  GROUP BY 1,2,3
),
calc AS (
  SELECT
    policy_start_year,
    week_number,
    third_level_organization,
    ( (sum_expense_amount / NULLIF(sum_doc_premium,0)) 
    + (sum_claim_payment / NULLIF(sum_expired_premium,0)) ) AS variable_cost_ratio
  FROM base
)
SELECT
  policy_start_year,
  week_number,
  third_level_organization,
  ROUND((1 - variable_cost_ratio), 4) AS marginal_contribution_ratio
FROM calc
ORDER BY policy_start_year, week_number, third_level_organization;


⸻

6. 口径说明
	•	公司口径（已统一多年）：

边际贡献率 = 1 – 变动成本率


	•	展示层：小数形式，保留 4 位小数（如 0.2834）。
	•	行业对比：边际贡献率常用于评估业务质量，与综合成本率互为补充；高边际贡献率意味着业务能够更好地覆盖费用并形成利润空间。