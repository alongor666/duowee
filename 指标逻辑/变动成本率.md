# 📌 变动成本率 | `variable_cost_ratio`

---

## 1. 指标定义
- **字段名**：`variable_cost_ratio`  
- **单位**：小数  
- **类型（DB 存储）**：`numeric(10,6)`（存库为小数，例：0.6534）  
- **展示精度**：保留 1 位小数  
- **含义**：反映在统计期内，业务在**满期责任期间**的整体变动成本水平，由费用与赔付共同构成。该指标为公司多年一致使用的核心口径，用于衡量业务盈利能力与风险成本。  

---

## 2. 计算公式（公司统一口径）
```text
变动成本率 (variable_cost_ratio) = 
    ( SUM(row_expense_amount_in_10k) ÷ SUM(documented_premium_in_10k) )
  + ( SUM(total_claim_payment_in_10k) ÷ SUM(expired_net_premium_in_10k) )

	•	费用部分：row_expense_amount_in_10k ÷ documented_premium_in_10k
	•	赔付部分：total_claim_payment_in_10k ÷ expired_net_premium_in_10k
	•	最终结果为两部分相加。

⸻

3. 计算顺序
	1.	推导 费用金额：

row_expense_amount_in_10k = documented_premium_in_10k × expense_ratio

	•	documented_premium_in_10k：签单保费，万元
	•	expense_ratio：费用率，小数（如 0.2156 表示 21.56%）

	2.	聚合基础值：
	•	sum_expense_amount = Σ(row_expense_amount_in_10k)
	•	sum_doc_premium = Σ(documented_premium_in_10k)
	•	sum_claim_payment = Σ(total_claim_payment_in_10k)
	•	sum_expired_premium = Σ(expired_net_premium_in_10k)
	3.	计算费用率部分：expense_part = sum_expense_amount ÷ sum_doc_premium
	4.	计算赔付率部分：loss_part = sum_claim_payment ÷ sum_expired_premium
	5.	汇总得到：variable_cost_ratio = expense_part + loss_part
	6.	存库为小数（如 0.7321）；报表展示时 ROUND(variable_cost_ratio, 4)。

⸻

4. 注意事项
	•	单位换算：分子与分母需保持同一单位（费用金额、签单保费、满期净保费均为万元）。
	•	口径统一：这是公司多年共识公式，不得改为简单的“费用率+赔付率”。
	•	边界条件：
	•	若 sum_doc_premium=0 或 sum_expired_premium=0，则该指标返回 NULL。
	•	建议设置异常检测：当结果 >100% 或 <0% 时，需校核数据。

⸻

5. 实现示例（Postgres / Supabase SQL）

WITH base AS (
  SELECT
    policy_start_year,
    week_number,
    third_level_organization,
    SUM(documented_premium_in_10k)      AS sum_doc_premium,
    SUM(expired_net_premium_in_10k)     AS sum_expired_premium,
    SUM(row_expense_amount_in_10k)      AS sum_expense_amount,
    SUM(total_claim_payment_in_10k)     AS sum_claim_payment
  FROM auto_insurance_metrics
  GROUP BY 1,2,3
)
SELECT
  policy_start_year,
  week_number,
  third_level_organization,
  CASE 
    WHEN sum_doc_premium > 0 AND sum_expired_premium > 0
      THEN ROUND(((sum_expense_amount / sum_doc_premium) 
                + (sum_claim_payment / sum_expired_premium)), 4)
    ELSE NULL
  END AS variable_cost_ratio
FROM base
ORDER BY policy_start_year, week_number, third_level_organization;


⸻

6. 口径说明
	•	公司口径（已长期使用）：

变动成本率 = （费用金额 ÷ 跟单保费） + （总赔款 ÷ 满期净保费）


	•	存储：小数形式（如 0.7345）；
	•	展示：小数形式，保留 4 位小数（如 0.7345）。
	•	行业视角：与常见“赔付率+费用率”不同，公司口径分母分别对应签单保费和满期保费，更符合风险与费用的真实承担。