# ğŸ“Œ ä¿è´¹è®¡åˆ’è¾¾æˆç‡ | `plan_achievement_rate`

---

## 1. æŒ‡æ ‡å®šä¹‰
- **å­—æ®µå**ï¼š`plan_achievement_rate`  
- **å•ä½**ï¼šå°æ•°  
- **ç±»å‹ï¼ˆDB å­˜å‚¨ï¼‰**ï¼š`numeric(10,6)`ï¼ˆå­˜åº“ä¸ºå°æ•°ï¼Œä¾‹ï¼š0.8567ï¼‰  
- **å±•ç¤ºç²¾åº¦**ï¼šä¿ç•™ 1 ä½å°æ•°  
- **å«ä¹‰**ï¼šè¡¡é‡å½“æœŸç´¯è®¡ç­¾å•ä¿è´¹ä¸è®¡åˆ’ä¿è´¹çš„å®Œæˆæƒ…å†µï¼Œåæ˜ ä¸šåŠ¡ç›®æ ‡çš„è½å®ç¨‹åº¦ä¸è¾¾æˆè¿›åº¦ã€‚  

---

## 2. è®¡ç®—å…¬å¼ï¼ˆå…¬å¸ç»Ÿä¸€å£å¾„ï¼Œæ¨å¯¼ï¼‰
è¡¨æ ¼ä¸­ `plan_achievement_rate` å·²æä¾›ï¼Œä½†å¯é€šè¿‡ä»¥ä¸‹å…¬å¼æ¨å¯¼æ ¡æ ¸ï¼š  

```text
ä¿è´¹è®¡åˆ’è¾¾æˆç‡ (plan_achievement_rate) = 
    ( SUM(documented_premium_in_10k) Ã· SUM(premium_plan) )

å…¶ä¸­ï¼š
	â€¢	documented_premium_in_10kï¼šç´¯è®¡ç­¾å•ä¿è´¹ï¼ˆä¸‡å…ƒï¼‰
	â€¢	premium_planï¼šä¿è´¹è®¡åˆ’ï¼ˆä¸‡å…ƒï¼Œäººå·¥å½•å…¥ï¼‰

â¸»

3. è®¡ç®—é¡ºåº
	1.	èšåˆåŸºç¡€å€¼ï¼š
	â€¢	sum_doc_premium = Î£(documented_premium_in_10k)
	â€¢	sum_premium_plan = Î£(premium_plan)
	2.	è®¡ç®—æ¯”ç‡ï¼š
	â€¢	plan_rate = sum_doc_premium Ã· sum_premium_plan
	3.	å­˜åº“å£å¾„ï¼šå°æ•°ï¼ˆå¦‚ 0.9231ï¼‰ï¼›
æŠ¥è¡¨å±•ç¤ºæ—¶ ROUND(plan_rate, 4)ï¼Œä¿ç•™ 4 ä½å°æ•°ã€‚

â¸»

4. æ³¨æ„äº‹é¡¹
	â€¢	æ•°æ®æ¥æºï¼špremium_plan ç”±äººå·¥å½•å…¥ï¼Œéœ€å®šæœŸæ ¡æ ¸å…¶å‡†ç¡®æ€§å’Œå®Œæ•´æ€§ã€‚
	â€¢	åˆ†æ¯ä¸º0æ—¶ï¼šè‹¥ premium_plan=0ï¼Œåˆ™æœ¬æŒ‡æ ‡è¿”å› NULL æˆ– 0ï¼Œé¿å…é™¤é›¶é”™è¯¯ã€‚
	â€¢	ç´¯è®¡å±æ€§ï¼šéœ€ç»“åˆ policy_start_yearã€week_number æŒ‰å¹´ç´¯è®¡å£å¾„å–æ•°ã€‚
	â€¢	ä¸šåŠ¡è§£è¯»ï¼š
	â€¢	è¾¾æˆç‡ â‰¥100% è¡¨ç¤ºç­¾å•ä¿è´¹è¶…é¢å®Œæˆè®¡åˆ’ï¼›
	â€¢	è¾¾æˆç‡ <100% è¡¨ç¤ºæœªè¾¾ç›®æ ‡ï¼Œéœ€è¦åˆ†æå·®è·åŸå› ã€‚

â¸»

5. å®ç°ç¤ºä¾‹ï¼ˆPostgres / Supabase SQLï¼‰

WITH base AS (
  SELECT
    policy_start_year,
    week_number,
    third_level_organization,
    SUM(documented_premium_in_10k) AS sum_doc_premium,
    SUM(premium_plan)              AS sum_premium_plan
  FROM auto_insurance_metrics
  GROUP BY 1,2,3
)
SELECT
  policy_start_year,
  week_number,
  third_level_organization,
  CASE 
    WHEN sum_premium_plan > 0
      THEN ROUND((sum_doc_premium / sum_premium_plan), 4)
    ELSE NULL
  END AS plan_achievement_rate
FROM base
ORDER BY policy_start_year, week_number, third_level_organization;


â¸»

6. å£å¾„è¯´æ˜
	â€¢	å…¬å¸å£å¾„ï¼š

ä¿è´¹è®¡åˆ’è¾¾æˆç‡ = ç­¾å•ä¿è´¹ Ã· ä¿è´¹è®¡åˆ’


	â€¢	å±•ç¤ºå±‚ï¼šä»¥å°æ•°å½¢å¼å‘ˆç°ï¼Œä¿ç•™ 4 ä½å°æ•°ã€‚
	â€¢	è¡Œä¸šå¯¹æ¯”ï¼šç­‰åŒäºå¸¸è§çš„â€œè®¡åˆ’è¾¾æˆç‡â€ï¼Œä½“ç°è®¡åˆ’ä¸å®é™…ä¸šåŠ¡é‡çš„åŒ¹é…ç¨‹åº¦ï¼Œå¸¸ç”¨äºè€ƒæ ¸æœºæ„å’Œå›¢é˜Ÿçš„ç›®æ ‡å®Œæˆæƒ…å†µã€‚