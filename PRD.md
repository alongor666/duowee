# 车险多维分析系统 · PRD（精简版）

## 概述
- 目标：以 4×4 KPI 看板 + 多维筛选，面向业务与管理者提供周度车险经营分析能力。
- 技术：Next.js 14（TS）、Tailwind、Context 状态、无后端示例数据/本地 CSV 导入。

## 关键能力
- KPI 看板（16 项）：绝对值、核心率值、运营指标、商业险专项。
- 多维筛选：年度、周次、机构、险种、保险类型、业务类型、客户分类、渠道等 17 维。
- 对比分析：同比/环比/自定义；可按筛选条件对比聚合值。
- 数据导入：CSV 模板下载、上传校验、错误/警告明细、一键复制/下载报告。
- 导出：KPI 概览 + 明细 CSV。

## 数据导入与校验
模板列顺序与测试数据.csv 完全一致，详见 README。

- 错误（阻塞导入）：
  - 必填字段为空（含年度/周次/机构/险种/保险类型等）。
  - 件数字段为负：`policy_count`、`claim_case_count`。
  - 单行解析失败或列数不匹配（该行跳过，计入明细）。
- 警告（不阻塞导入）：
  - `reported_claim_payment_yuan`、`expense_amount_yuan` 为负（冲销）。
  - 数值为空/非法（按场景提示）。
- 忽略（不提示）：
  - `claim_case_count > policy_count`（在旧案跨期/并案等场景合理）。

报告能力：
- 逐行“问题明细”（行号/字段/级别/说明）。
- 汇总“解析阶段跳过行数”。
- 一键复制/下载验证报告。

## 筛选器 UX（确认后隐藏）
- 默认展开常用维度：年度、周次、机构、保险类型、险种。
- 草稿-应用模式：变更先暂存，点击“应用筛选”后生效并写入 URL（可分享复现）。
- 应用后自动收起为“摘要条”（显示记录数与已选关键信息），支持“调整筛选/清空”。
- 多选增强：全选/清空/反选；周次支持“范围选择”“最近4周”。

## KPI 口径（聚合后计算）
- 满期赔付率 = 已报告赔款 / 满期保费 × 100（上升为负向）。
- 费用率 = 费用金额 / 签单保费 × 100（上升为负向）。
- 变动成本率 = 费用金额/签单保费 + 已报告赔款/满期保费。
- 满期边际贡献率 = 满期边际贡献额 / 满期保费 × 100。
- 满期出险率 = (赔案件数 / 保单件数) × (满期保费 / 签单保费) × 100（上升为负向）。
- 单均保费 = 签单保费 / 保单件数；案均赔款 = 已报告赔款 / 赔案件数（上升为负向）。
- 商业险自主系数 = 签单保费 / 商业险折前保费。

## 视觉风格（Apple Keynote）
- 背景：柔和渐变 + 留白；卡片：玻璃态（backdrop-blur）与轻阴影；标题：渐变字色。
- 动效轻量：加载/渐入/小幅滑入，避免喧宾夺主。

## 非功能需求
- 性能：本地数据 1–3 万行 CSV 流畅操作（按浏览器能力）。
- 易用：一键复制报告、URL 参数分享、筛选方案本地保存。
- 安全：不提交真实业务数据；环境变量入 .env.local。

## 迭代建议
- 忽略规则设置：允许用户在本地偏好中关闭某类警告显示。
- 机构树选择/多层级汇总；KPI 点击下钻；图表化分布视图。
