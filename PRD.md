# 车险多维分析系统

## 概述
- 目标：以 4×4 KPI 看板 + 多维筛选，面向业务与管理者提供周度车险经营分析能力。
- 技术：Next.js 14（TS）、Tailwind、Context 状态、无后端示例数据/本地 CSV 导入。

## 设计理念与原则
- 信息架构优先：采用倒金字塔结构，核心指标置于视觉焦点，确保用户在 5 秒内理解页面主旨。
- 语义一致：色彩、图标、动效均遵循统一语义（如红=警告、绿=正常、蓝=中性），保持体验一致。
- 渐进披露：复杂能力按层级逐步呈现，避免一次性暴露所有控件造成认知过载。
- 数据驱动：所有设计围绕决策需求展开，突出趋势、异常、对比与效率洞察。

### 设计系统蓝图
- **色彩语义体系**：
  - 核心语义色：危险/风险（#F04438）、正常/正向（#12B76A）、中性/默认（#1D4ED8）、提示/待关注（#F79009）。
  - 辅助色：背景柔和灰（#F8FAFC）、分隔线（#E2E8F0）、浅色/深色主题在 4:5 明度对比内转换。
  - 色彩使用规范：红色仅用于负向趋势或警报，绿色用于目标达成，蓝色用于默认数据，橙色作为“待关注”或预测提醒；图表中最多 6 个对比色，确保色盲安全（选用 Material Design Safe 组合）。
- **字体层级体系**：
  - 标题（H1/H2/H3）：46/32/24 px，字重 600，行距 1.2，支持渐变标题以强调模块主题。
  - 正文（Body/Micro）：16/14 px，字重 400，行距 1.5，提供 12 px 辅助标签，统一使用数字等宽字体展示指标。
  - 信息密度：KPI 卡片保留 16 px 内边距，核心指标与辅助指标之间保持 8 px 间距。
- **核心组件倒金字塔信息层**：
  - KPI 卡片：顶部为 5 秒核心指标（数值 + 环比/同比箭头），中层展示关键维度（如机构/险种标签），底部展示数据解释与操作（下钻/添加至收藏）。
  - 图表容器：首屏显示图表标题 + 关键结论摘要（例如“赔付率连续 3 周下降 5%”），主体为图表本体，底部提供筛选摘要与异常说明。
  - 筛选面板：第一层显示最常用维度（年度、周次、机构），第二层折叠高级维度，第三层提供保存/预测推荐区。

## 关键能力
- KPI 看板（16 项）：绝对值、核心率值、运营指标、商业险专项。
- 多维筛选：年度、周次、机构层级、三级机构/城市、保险类型、保障方案、业务类型分类、客户三级分类、是否新能源车、是否过户车、新续转状态、车险评级、高速风险等级、大货车评分、小货车评分、终端来源共16维。
- 对比分析：同比/环比/自定义；可按筛选条件对比聚合值。
- 数据导入：CSV 模板下载、上传校验、错误/警告明细、一键复制/下载报告。
- 导出：KPI 概览 + 明细 CSV。

## 信息架构与交互策略
- 筛选面板：默认展示常用维度，支持草稿-应用模式，应用后折叠为摘要条并保留上下文筛选状态。
- 快捷操作：提供最新周、最近 4 周、本年度、仅商业险等快捷按钮，并支持键盘快捷键与触控手势。
- 图表联动：单图点击可驱动其他图表同步刷新，保持筛选上下文一致。
- 实时反馈：筛选、钻取、对比切换提供即时响应，避免等待感。

## 仪表板信息架构规划
- 布局：采用 12 列响应式栅格，首屏显示 4×4 KPI 卡片，上方保留全局筛选摘要条，图表区域分为“趋势洞察”“结构对比”“区域聚焦”三段。
- 5 秒核心信息：每个区域的首个元素必须在 5 秒内呈现主要结论，并在标题下方以微文案加粗提示。

| 区块 | 视图名称 | 5 秒核心信息 | 图表类型 | 联动逻辑 |
| --- | --- | --- | --- | --- |
| KPI 看板 | 核心经营指标（保费、赔付率、费用率、边际贡献） | “本周 vs 上周差异 + 达成率” | 数字+迷你趋势线 | 点击 KPI 触发对应图表高亮，下钻到机构/险种细分 |
| 趋势洞察 | 保费与赔付趋势 | “近 8 周趋势方向与异常周” | 双轴折线图 | 受全局筛选影响；点击异常点同步打开异常说明卡片 |
| 趋势洞察 | 理赔处理时效 | “平均处理时长是否超阈” | 面积+折线混合图 | 与“理赔效率”KPI 联动，选择时间段同步更新处理时长分布 |
| 结构对比 | 机构对比 | “Top/Btm 5 机构贡献与赔付差异” | 水平条形图 | 点击机构刷新右侧险种分布饼图，并在 KPI 摘要中突出该机构数据 |
| 结构对比 | 险种构成 | “商业险 vs 交强险占比” | 环形图 | 继承机构筛选状态；点击分区向趋势图发送筛选事件 |
| 区域聚焦 | 区域热力 | “高赔付率地区” | 地图热力/矩形树图（按终端） | 与“异常预警列表”双向联动，点击区域刷新异常列表 |
| 区域聚焦 | 异常预警列表 | “异常指标与建议动作” | 列表 + 标签 | 监听所有图表点击事件，展示对应筛选上下文并支持导出 |

- 响应式策略：桌面端三段并排；平板堆叠为双列；移动端以卡片形式纵向排列，首屏保留 4 个 KPI 与趋势图。

## 数据导入与校验
模板列顺序与测试数据.csv 完全一致，详见 README。

- 错误（阻塞导入）：
  - 必填字段为空（含年度/周次/机构/险种/保险类型等）。
  - 件数字段为负：`policy_count`、`claim_case_count`。
  - 单行解析失败或列数不匹配（该行跳过，计入明细）。
- 警告（不阻塞导入）：
  - `reported_claim_payment_yuan`、`expense_amount_yuan` 为负（冲销）。
  - 数值为空/非法（按场景提示）。
- 忽略（不提示）：
  - `claim_case_count > policy_count`（在旧案跨期/并案等场景合理）。

报告能力：
- 逐行“问题明细”（行号/字段/级别/说明）。
- 汇总“解析阶段跳过行数”。
- 一键复制/下载验证报告，导入成功后自动保存快照并预设最新两周对比。
- 支持多文件并行解析：按文件出具校验摘要，检测重复周次并提示覆盖策略。

## 数据恢复与对比
- 浏览器本地缓存最近一次导入结果（IndexedDB+localStorage），刷新后自动恢复数据与筛选项。
- 识别导入数据的最近两周期，自动启用自定义对比（Latest vs Previous）。
- 提供“数据清空”入口以移除本地快照。

## 筛选器 UX（确认后隐藏）
- 默认展开常用维度：年度、周次、三级机构、业务类型、车险种类。
- 草稿-应用模式：变更先暂存，点击“应用筛选”后生效并写入 URL（可分享复现）。
- 应用后自动收起为“摘要条”（显示记录数与已选关键信息），支持“调整筛选/清空”，点击面板外部自动隐藏。
- 多选：全选/清空/反选；周次支持“范围选择”“最近4周”。
- 新增常用快捷按钮：最新周、最近4周、本年度、仅商业险，点击后立即应用并折叠面板。

## 智能交互流程
- **预测式筛选**：
  1. 用户在筛选面板输入关键字（如“天府”），系统基于历史筛选记录与业务热点推荐前三项维度组合，并标记预测可信度。
  2. 推荐项悬浮时展示“预计影响指标”提示卡（引用 KPI 数据快照）。
  3. 用户选择后立即生成预览标签，支持一键应用或保存为常用方案。
- **渐进式披露**：
  1. 首屏仅展示基础筛选与核心 KPI，当用户点击“深入分析”按钮后展开二级视图（趋势洞察 + 结构对比）。
  2. 在趋势图上点击异常点弹出侧边层，展示详细表格与建议动作；若用户进一步点击“查看关联事件”，再打开三级信息（原始记录、注释、分享）。
- **实时反馈**：
  1. 所有筛选/图表操作均触发 loading skeleton < 200ms；
  2. 图表更新采用局部重绘并保留过渡动效（150–200ms），同时在筛选摘要条中闪现“已更新”提示；
  3. 失败时提供可恢复提示（重试按钮 + 联系人信息），并回滚至上一个成功状态。

## KPI 口径（聚合后计算）
- 满期赔付率 = 已报告赔款 / 满期保费 × 100（上升为负向）。
- 费用率 = 费用金额 / 签单保费 × 100（上升为负向）。
- 变动成本率 = (费用金额 ÷ 签单保费) + (已报告赔款 ÷ 满期保费)（结果以百分比展示，上升为负向）。
- 满期边际贡献率 = 满期边际贡献额 / 满期保费 × 100。
- 满期出险率 = (赔案件数 / 保单件数) × (满期保费 / 签单保费) × 100（上升为负向）。
- 单均保费 = 签单保费 / 保单件数；案均赔款 = 已报告赔款 / 赔案件数（上升为负向）。
- 商业险自主系数 = 签单保费 / 商业险折前保费。

## 数据可视化规范
- 图表选择：趋势=折线图、占比=饼/环图、对比=柱图、相关性=散点图，避免 3D 和夸张装饰。
- 数据密度：遵循“数据墨水比”原则，自动聚合时间粒度，保持信息密度与可读性平衡。
- 异常标注：自动识别并高亮异常点，提示变化原因或业务解读。
- 动效准则：动效用于强调趋势与切换，保持节奏克制，不干扰阅读。

## 视觉风格（Apple Keynote）
- 背景：柔和渐变 + 合理留白；卡片：玻璃态（backdrop-blur）与轻阴影；标题：渐变字色。
- 字体层级：字号、字重、行距成体系，强化主次；正文保持高对比度与充足间距。
- 色彩体系：构建语义化配色（红=警告、绿=正常、蓝=中性），支持浅色/深色主题切换。
- 高分屏适配：保证 4K/Retina 下的像素精度与图标清晰度。

## 非功能需求
- 性能：本地数据 1–3 万行 CSV 流畅操作（按浏览器能力）。
- 易用：一键复制报告、URL 参数分享、筛选方案本地保存。
- 安全：不提交真实业务数据；环境变量入 .env.local。

## 性能与响应式方案
- **数据懒加载**：
  - 初次渲染仅请求 KPI 汇总与关键趋势数据，其余视图在进入视口或用户互动时再异步加载。
  - 使用 Web Worker 解析 CSV，主线程仅接收聚合结果，避免 UI 卡顿。
- **缓存策略**：
  - IndexedDB 存储原始数据与聚合快照；localStorage 保存筛选条件、主题设置与布局方案。
  - 设置 24 小时 TTL，超过自动触发后台刷新；手动刷新时保留旧数据直至新数据就绪（stale-while-revalidate）。
- **图表自适应规范**：
  - 栅格断点：≥1280px（四列）、≥960px（三列）、≥640px（两列）、<640px（单列）。
  - 轴标签自动旋转/省略，迷你图在移动端切换为面积图卡片，地图在移动端替换为列表热力。
- **性能监控**：
  - 关键指标：首次内容绘制 < 2s，交互响应 < 200ms，图表切换 < 400ms。
  - 埋点工具：利用 Web Vitals + 自研埋点上报筛选耗时、加载失败率，并在仪表板内置性能调试模式。

## 迭代建议
- 忽略规则设置：允许用户在本地偏好中关闭某类警告显示。
- 机构树选择/多层级汇总；KPI 点击下钻；图表化分布视图。
- 智能推荐：基于用户行为历史提供预测性筛选、推荐关注指标。
- 协同扩展：支持注释、分享视图与多格式导出，完善协作闭环。

## 个性化与协作能力路线
- **布局拖拽**：采用虚拟栅格 + 拖拽库（如 React Grid Layout），支持保存多个布局方案并设置默认视图；拖拽时提供吸附对齐与栅格高亮反馈。
- **视图保存**：
  - 本地：保存筛选组合、布局与主题到 IndexedDB，列表展示最近使用与共享的方案。
  - 云端（未来扩展）：提供分享链接，附带有效期与访问控制。
- **主题切换**：维护统一主题 Token（颜色、阴影、圆角），在浅色/深色间动态切换；允许用户进一步调节对比度以适配高亮需求。
- **注释与分享**：图表右上角提供“添加注释”入口，可标记某个数据点并 @ 成员；注释面板支持 Markdown、上传截图，并同步更新到协作日志。
- **导出能力**：一键导出 PDF（看板快照）、CSV（当前筛选结果）与 PPT（含关键图表 + 注释摘要），导出前展示预览与敏感字段脱敏选项。

## 行业标杆评估与成功要素
- **差异化对标**：
  - Tableau：可视化自由度高但学习曲线陡峭；本产品聚焦标准化仪表板与 5 秒核心信息，让业务用户零学习即可使用。
  - Power BI：数据集成与建模强；我们利用本地 CSV + 智能筛选提供轻量部署，并通过预测式筛选弥补缺乏复杂建模的痛点。
  - 阿里 DataV：大屏炫酷但交互复杂；我们以倒金字塔信息层和渐进披露保障信息可读性，减少视觉噪音。
- **差异化要点总结**：5 秒洞察、预测筛选、自动异常说明、拖拽布局 + 主题 Token、内置性能自监控。
- **迭代节奏**：
  - M0（当前）：完成基础仪表板、懒加载、缓存与主题切换能力。
  - M1：上线预测式筛选、异常说明卡、拖拽布局 Beta，邀请核心用户试用。
  - M2：开放注释分享、云端视图同步，叠加性能自监控仪表板并评估新数据源接入。
- **成功关键**：建立统一设计系统，保持跨职能团队的每周例会，持续开展用户访谈与可用性测试，确保体验围绕业务决策价值持续迭代。
