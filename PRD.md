# 车险多维分析系统 · PRD（精简版）

## 概述
- 目标：以 4×4 KPI 看板 + 多维筛选，面向业务与管理者提供周度车险经营分析能力。
- 技术：Next.js 14（TS）、Tailwind、Context 状态、无后端示例数据/本地 CSV 导入。

## 设计理念与原则
- 信息架构优先：采用倒金字塔结构，核心指标置于视觉焦点，确保用户在 5 秒内理解页面主旨。
- 语义一致：色彩、图标、动效均遵循统一语义（如红=警告、绿=正常、蓝=中性），保持体验一致。
- 渐进披露：复杂能力按层级逐步呈现，避免一次性暴露所有控件造成认知过载。
- 数据驱动：所有设计围绕决策需求展开，突出趋势、异常、对比与效率洞察。

## 关键能力
- KPI 看板（16 项）：绝对值、核心率值、运营指标、商业险专项。
- 多维筛选：年度、周次、机构、险种、保险类型、业务类型、客户分类、渠道等 17 维。
- 对比分析：同比/环比/自定义；可按筛选条件对比聚合值。
- 数据导入：CSV 模板下载、上传校验、错误/警告明细、一键复制/下载报告。
- 导出：KPI 概览 + 明细 CSV。

## 信息架构与交互策略
- 筛选面板：默认展示常用维度，支持草稿-应用模式，应用后折叠为摘要条并保留上下文筛选状态。
- 快捷操作：提供最新周、最近 4 周、本年度、仅商业险等快捷按钮，并支持键盘快捷键与触控手势。
- 图表联动：单图点击可驱动其他图表同步刷新，保持筛选上下文一致。
- 实时反馈：筛选、钻取、对比切换提供即时响应，避免等待感。

## 数据导入与校验
模板列顺序与测试数据.csv 完全一致，详见 README。

- 错误（阻塞导入）：
  - 必填字段为空（含年度/周次/机构/险种/保险类型等）。
  - 件数字段为负：`policy_count`、`claim_case_count`。
  - 单行解析失败或列数不匹配（该行跳过，计入明细）。
- 警告（不阻塞导入）：
  - `reported_claim_payment_yuan`、`expense_amount_yuan` 为负（冲销）。
  - 数值为空/非法（按场景提示）。
- 忽略（不提示）：
  - `claim_case_count > policy_count`（在旧案跨期/并案等场景合理）。

报告能力：
- 逐行“问题明细”（行号/字段/级别/说明）。
- 汇总“解析阶段跳过行数”。
- 一键复制/下载验证报告，导入成功后自动保存快照并预设最新两周对比。
- 支持多文件并行解析：按文件出具校验摘要，检测重复周次并提示覆盖策略。

## 数据恢复与对比
- 浏览器本地缓存最近一次导入结果（IndexedDB+localStorage），刷新后自动恢复数据与筛选项。
- 识别导入数据的最近两周期，自动启用自定义对比（Latest vs Previous）。
- 提供“数据清空”入口以移除本地快照。

## 筛选器 UX（确认后隐藏）
- 默认展开常用维度：年度、周次、机构、保险类型、险种。
- 草稿-应用模式：变更先暂存，点击“应用筛选”后生效并写入 URL（可分享复现）。
- 应用后自动收起为“摘要条”（显示记录数与已选关键信息），支持“调整筛选/清空”，点击面板外部自动隐藏。
- 多选增强：全选/清空/反选；周次支持“范围选择”“最近4周”。
- 新增常用快捷按钮：最新周、最近4周、本年度、仅商业险，点击后立即应用并折叠面板。

## KPI 口径（聚合后计算）
- 满期赔付率 = 已报告赔款 / 满期保费 × 100（上升为负向）。
- 费用率 = 费用金额 / 签单保费 × 100（上升为负向）。
- 变动成本率 = (费用金额 ÷ 签单保费) + (已报告赔款 ÷ 满期保费)（结果以百分比展示，上升为负向）。
- 满期边际贡献率 = 满期边际贡献额 / 满期保费 × 100。
- 满期出险率 = (赔案件数 / 保单件数) × (满期保费 / 签单保费) × 100（上升为负向）。
- 单均保费 = 签单保费 / 保单件数；案均赔款 = 已报告赔款 / 赔案件数（上升为负向）。
- 商业险自主系数 = 签单保费 / 商业险折前保费。

## 数据可视化规范
- 图表选择：趋势=折线图、占比=饼/环图、对比=柱图、相关性=散点图，避免 3D 和夸张装饰。
- 数据密度：遵循“数据墨水比”原则，自动聚合时间粒度，保持信息密度与可读性平衡。
- 异常标注：自动识别并高亮异常点，提示变化原因或业务解读。
- 动效准则：动效用于强调趋势与切换，保持节奏克制，不干扰阅读。

## 视觉风格（Apple Keynote）
- 背景：柔和渐变 + 合理留白；卡片：玻璃态（backdrop-blur）与轻阴影；标题：渐变字色。
- 字体层级：字号、字重、行距成体系，强化主次；正文保持高对比度与充足间距。
- 色彩体系：构建语义化配色（红=警告、绿=正常、蓝=中性），支持浅色/深色主题切换。
- 高分屏适配：保证 4K/Retina 下的像素精度与图标清晰度。

## 非功能需求
- 性能：本地数据 1–3 万行 CSV 流畅操作（按浏览器能力）。
- 易用：一键复制报告、URL 参数分享、筛选方案本地保存。
- 安全：不提交真实业务数据；环境变量入 .env.local。

## 技术架构与性能优化
- 数据懒加载：按需加载图表数据，配合虚拟滚动处理大数据列表。
- 缓存策略：IndexedDB + localStorage 缓存常用查询与筛选结果，支持离线恢复。
- 响应式设计：图表与布局自适应桌面、平板、移动端，触控操作友好。
- 实时监控：埋点采集交互性能，及时优化瓶颈。

## 迭代建议
- 忽略规则设置：允许用户在本地偏好中关闭某类警告显示。
- 机构树选择/多层级汇总；KPI 点击下钻；图表化分布视图。
- 智能推荐：基于用户行为历史提供预测性筛选、推荐关注指标。
- 协同扩展：支持注释、分享视图与多格式导出，完善协作闭环。

## 行业标杆与成功要素
- 对标 Tableau、Power BI、Looker 等国际产品及阿里 DataV、腾讯云图、百度 Sugar 等国内方案。
- 建立统一设计系统，确保视觉、交互与数据口径的一致性。
- 持续开展用户访谈与可用性测试，迭代验证关键体验。
- 保持设计、开发、业务团队的跨职能协作，聚焦用户决策价值。
